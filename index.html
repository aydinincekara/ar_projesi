<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eğitim Galaksisi</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        // =================================================================
        // 1. GALAKSİ VERİTABANI (TÜM İÇERİK BURADA)
        // =================================================================
        const galaxyData = [
            {
                id: "cube-genel",
                title: "GENEL TEKNOLOJİ",
                color: "#2d3436",
                faces: [
                    { txt: "AR", sub: "Artirilmis Gerceklik", col: "#ff4757", modal: "modal-ar" },
                    { txt: "VR", sub: "Sanal Gerceklik", col: "#3742fa", modal: "modal-vr" },
                    { txt: "STEM", sub: "Maker Kulturu", col: "#2ed573", modal: "modal-stem" },
                    { txt: "AI", sub: "Yapay Zeka", col: "#ffa502", modal: "modal-ai" },
                    { txt: "3D PRINT", sub: "Uretim", col: "#ff6348", modal: "modal-print" },
                    { txt: "SCAN", sub: "Tarama", col: "#5352ed", modal: "modal-scan" }
                ]
            },
            {
                id: "cube-yazilim",
                title: "YAZILIM DÜNYASI",
                color: "#2c3e50",
                faces: [
                    { txt: "PYTHON", sub: "Veri Bilimi", col: "#f1c40f", modal: "modal-python" },
                    { txt: "UNITY", sub: "Oyun Motoru", col: "#000000", modal: "modal-unity" },
                    { txt: "C#", sub: "Nesne Tabanli", col: "#9b59b6", modal: "modal-csharp" },
                    { txt: "WEB", sub: "HTML/CSS", col: "#e67e22", modal: "modal-web" },
                    { txt: "JAVA", sub: "Mobil App", col: "#e74c3c", modal: "modal-java" },
                    { txt: "SQL", sub: "Veritabani", col: "#34495e", modal: "modal-sql" }
                ]
            },
            {
                id: "cube-robotik",
                title: "ROBOTİK & IOT",
                color: "#192a56",
                faces: [
                    { txt: "ARDUINO", sub: "Mikrodenetleyici", col: "#00979d", modal: "modal-arduino" },
                    { txt: "RASPBERRY", sub: "Mini Bilgisayar", col: "#c0392b", modal: "modal-pi" },
                    { txt: "SENSOR", sub: "Algilayicilar", col: "#27ae60", modal: "modal-sensor" },
                    { txt: "IOT", sub: "Akilli Ev", col: "#8e44ad", modal: "modal-iot" },
                    { txt: "MOTOR", sub: "Hareket", col: "#f39c12", modal: "modal-motor" },
                    { txt: "DRONE", sub: "IHA", col: "#2980b9", modal: "modal-drone" }
                ]
            },
            {
                id: "cube-tasarim",
                title: "TASARIM & ÜRETİM",
                color: "#4a0b0b",
                faces: [
                    { txt: "TINKERCAD", sub: "Basit 3D", col: "#1abc9c", modal: "modal-tinker" },
                    { txt: "FUSION360", sub: "Muhendislik", col: "#e67e22", modal: "modal-fusion" },
                    { txt: "BLENDER", sub: "Sanatsal 3D", col: "#d35400", modal: "modal-blender" },
                    { txt: "CURA", sub: "Dilimleme", col: "#3498db", modal: "modal-cura" },
                    { txt: "LASER", sub: "Kesim", col: "#c0392b", modal: "modal-laser" },
                    { txt: "CNC", sub: "Talasli Imalat", col: "#7f8c8d", modal: "modal-cnc" }
                ]
            },
            {
                id: "cube-egitim",
                title: "EĞİTİM YÖNTEMLERİ",
                color: "#4834d4",
                faces: [
                    { txt: "GAMIFY", sub: "Oyunlastirma", col: "#686de0", modal: "modal-game" },
                    { txt: "FLIPPED", sub: "Ters Yuz", col: "#30336b", modal: "modal-flip" },
                    { txt: "PROJECT", sub: "Proje Tabanli", col: "#be2edd", modal: "modal-pbl" },
                    { txt: "PEER", sub: "Akran Ogretimi", col: "#22a6b3", modal: "modal-peer" },
                    { txt: "ONLINE", sub: "Uzaktan Egt.", col: "#eb4d4b", modal: "modal-zoom" },
                    { txt: "HYBRID", sub: "Karma", col: "#f0932b", modal: "modal-hybrid" }
                ]
            }
        ];

        // Global Durum Yönetimi
        let activeCubeId = 0; // Şu an merkezdeki küpün indexi
        let isAnimating = false; // Animasyon sırasında tıklamayı engellemek için

        // =================================================================
        // 2. GALAKSİ YÖNETİCİSİ (LAYOUT ENGINE)
        // =================================================================
        AFRAME.registerComponent('galaksi-yoneticisi', {
            init: function () {
                this.setupScene();
            },

            setupScene: function() {
                const container = this.el;
                const isMobile = window.matchMedia("(max-width: 768px)").matches;
                
                // Merkez ve Halka Ayarları
                // Mobilde halkayı biraz daha dar yapıyoruz
                const radius = isMobile ? 3.5 : 5; 
                const centerPos = isMobile ? {x:0, y:1.3, z:-2} : {x:0, y:0, z:0};
                
                galaxyData.forEach((data, index) => {
                    // Küpü oluştur (HTML String yerine DOM metoduyla)
                    let wrapper = document.createElement('a-entity');
                    wrapper.setAttribute('id', `wrapper-${index}`);
                    wrapper.setAttribute('class', 'cube-wrapper');
                    wrapper.setAttribute('galaksi-etkilesim', `id: ${index}`);
                    
                    // İlk pozisyonlama
                    if (index === 0) {
                        // İlk küp merkezde
                        wrapper.setAttribute('position', centerPos);
                        wrapper.setAttribute('scale', isMobile ? '0.4 0.4 0.4' : '0.6 0.6 0.6');
                        wrapper.setAttribute('akilli-kontrol', 'enabled: true'); // Sadece merkezdeki dönebilir
                    } else {
                        // Diğerleri halkada
                        // Yarım daire formülü (180 dereceye yay)
                        let angle = ((index - 1) / (galaxyData.length - 1)) * Math.PI - (Math.PI / 2); // -90 ile +90 arası
                        // Biraz daha arkaya atmak için Z offset
                        let posX = Math.sin(angle) * radius * 1.5; 
                        let posZ = -Math.cos(angle) * radius * 0.8 - (isMobile ? 3 : 5);
                        
                        wrapper.setAttribute('position', `${posX} ${isMobile?1.3:0} ${posZ}`);
                        wrapper.setAttribute('scale', isMobile ? '0.25 0.25 0.25' : '0.35 0.35 0.35');
                        
                        // Halkadakiler merkeze baksın
                        let lookAtPos = new THREE.Vector3(centerPos.x, centerPos.y, centerPos.z);
                        wrapper.object3D.lookAt(lookAtPos);
                        
                        // Yavaşça kendi etrafında dönsün (Idle Animation)
                        wrapper.setAttribute('animation__idle', {
                            property: 'rotation.y', to: 360, dur: 20000, loop: true, easing: 'linear'
                        });
                    }

                    // KÜP GÖRSELİ OLUŞTURMA
                    this.createCubeVisuals(wrapper, data);
                    container.appendChild(wrapper);
                });

                // Başlığı güncelle
                updateTitle(galaxyData[0].title);
            },

            createCubeVisuals: function(parent, data) {
                // 1. Ana Kutu
                let box = document.createElement('a-box');
                box.setAttribute('color', data.color);
                box.setAttribute('depth', 1); box.setAttribute('height', 1); box.setAttribute('width', 1);
                box.setAttribute('material', 'roughness: 0.3; metalness: 0.1');
                parent.appendChild(box);

                // 2. Yüzeyler (Data'dan otomatik)
                // Pozisyon ve rotasyon matrisi (Ön, Sağ, Arka, Sol, Üst, Alt)
                const transforms = [
                    {pos: "0 0 0.51", rot: "0 0 0"},      // Ön
                    {pos: "0.51 0 0", rot: "0 90 0"},     // Sağ
                    {pos: "0 0 -0.51", rot: "0 180 0"},   // Arka
                    {pos: "-0.51 0 0", rot: "0 -90 0"},   // Sol
                    {pos: "0 0.51 0", rot: "-90 0 0"},    // Üst
                    {pos: "0 -0.51 0", rot: "90 0 0"}     // Alt
                ];

                data.faces.forEach((face, i) => {
                    let faceGroup = document.createElement('a-entity');
                    faceGroup.setAttribute('position', transforms[i].pos);
                    faceGroup.setAttribute('rotation', transforms[i].rot);

                    // Tıklanabilir Panel
                    let plane = document.createElement('a-plane');
                    plane.setAttribute('class', 'tiklanabilir');
                    plane.setAttribute('width', 1); plane.setAttribute('height', 1);
                    plane.setAttribute('color', face.col); plane.setAttribute('opacity', 0.15);
                    plane.setAttribute('data-modal', face.modal); // Modal ID'si
                    
                    // Panel Etkileşimi (Parlama ve Modal Açma)
                    plane.addEventListener('click', (e) => {
                        // Sadece merkezdeki küpün yüzeyleri tıklanabilir olmalı
                        let parentID = parent.getAttribute('galaksi-etkilesim').id;
                        if(parseInt(parentID) === activeCubeId && !isAnimating) {
                            // Parlama
                            plane.setAttribute('animation__flash', {property: 'material.opacity', from: 0.8, to: 0.15, dur: 300});
                            if(navigator.vibrate) navigator.vibrate(50);
                            modalAc(face.modal);
                            e.stopPropagation(); // Küp değişimini tetikleme
                        }
                    });

                    faceGroup.appendChild(plane);

                    // Yazılar (Akıllı Boyutlandırma)
                    let txt = document.createElement('a-text');
                    txt.setAttribute('value', face.txt);
                    txt.setAttribute('align', 'center');
                    txt.setAttribute('position', '0 0.1 0.01');
                    let len = face.txt.length;
                    let width = len > 6 ? 6 : (len > 3 ? 8 : 10);
                    txt.setAttribute('width', width);
                    faceGroup.appendChild(txt);

                    // Alt Yazı
                    let sub = document.createElement('a-text');
                    sub.setAttribute('value', face.sub);
                    sub.setAttribute('align', 'center');
                    sub.setAttribute('position', '0 -0.2 0.01');
                    sub.setAttribute('width', 3);
                    sub.setAttribute('color', '#ccc');
                    faceGroup.appendChild(sub);

                    parent.appendChild(faceGroup);
                });
            }
        });

        // =================================================================
        // 3. ETKİLEŞİM VE YER DEĞİŞTİRME (SWAP LOGIC)
        // =================================================================
        AFRAME.registerComponent('galaksi-etkilesim', {
            schema: { id: {type: 'int'} },
            init: function () {
                this.timer = null;
                this.isLongPress = false;
                
                // Mouse Down (Zamanlayıcı Başlat)
                this.el.addEventListener('mousedown', (e) => this.startPress(e));
                this.el.addEventListener('touchstart', (e) => this.startPress(e), {passive: false});

                // Mouse Up (İşlem Yap)
                this.el.addEventListener('mouseup', (e) => this.endPress(e));
                this.el.addEventListener('touchend', (e) => this.endPress(e));
            },

            startPress: function(e) {
                if(isAnimating) return;
                this.isLongPress = false;
                // 600ms basılı tutulursa "Uzun Basış" kabul et
                this.timer = setTimeout(() => {
                    this.isLongPress = true;
                    if(navigator.vibrate) navigator.vibrate([50, 50, 50]); // Çift titreşim
                    // Görsel geri bildirim (Hafif büyüme)
                    this.el.setAttribute('animation__pulse', {
                        property: 'scale', to: '1.2 1.2 1.2', dur: 200, dir: 'alternate', loop: 2
                    });
                }, 600);
            },

            endPress: function(e) {
                if(this.timer) clearTimeout(this.timer);
                if(isAnimating) return;

                // Eğer bu küp zaten merkezdeyse ve uzun basılmadıysa hiçbir şey yapma (Döndürme motoru devrede)
                if(this.data.id === activeCubeId) return;

                // Eğer kenardaki bir küpse ve tıklandıysa -> MERKEZE GEL
                // Uzun basış olsa da olmasa da merkeze gelsin (Tercih meselesi)
                this.swapCubes(this.data.id);
            },

            swapCubes: function(targetId) {
                if(isAnimating) return;
                isAnimating = true;

                let oldCenterEl = document.querySelector(`#wrapper-${activeCubeId}`);
                let newCenterEl = document.querySelector(`#wrapper-${targetId}`);
                
                // Pozisyonları kaydet
                let centerPos = oldCenterEl.getAttribute('position');
                let targetPos = newCenterEl.getAttribute('position');
                
                // Ölçekleri kaydet
                let centerScale = oldCenterEl.getAttribute('scale');
                let targetScale = newCenterEl.getAttribute('scale');

                // 1. ESKİ MERKEZİ YENİ YERİNE GÖNDER
                oldCenterEl.removeAttribute('akilli-kontrol'); // Kontrolü kapat
                oldCenterEl.setAttribute('animation__move', {
                    property: 'position', to: targetPos, dur: 1000, easing: 'easeInOutQuart'
                });
                oldCenterEl.setAttribute('animation__scale', {
                    property: 'scale', to: targetScale, dur: 1000, easing: 'easeInOutQuart'
                });
                // Eski merkez halkaya dönünce yavaşça dönmeye başlasın
                oldCenterEl.setAttribute('animation__idle', {
                    property: 'rotation.y', to: 360, dur: 20000, loop: true, easing: 'linear', delay: 1000
                });

                // 2. YENİ KÜPÜ MERKEZE ÇEK
                newCenterEl.removeAttribute('animation__idle'); // Dönmeyi bırak
                // Rotasyonu sıfırla ki düzgün gelsin
                newCenterEl.setAttribute('animation__rotreset', {
                    property: 'rotation', to: '0 0 0', dur: 500
                });
                newCenterEl.setAttribute('animation__move', {
                    property: 'position', to: centerPos, dur: 1000, easing: 'easeInOutQuart'
                });
                newCenterEl.setAttribute('animation__scale', {
                    property: 'scale', to: centerScale, dur: 1000, easing: 'easeInOutQuart'
                });

                // Başlığı Güncelle
                updateTitle(galaxyData[targetId].title);

                // Animasyon bitince
                setTimeout(() => {
                    activeCubeId = targetId;
                    newCenterEl.setAttribute('akilli-kontrol', 'enabled: true'); // Kontrolü aç
                    isAnimating = false;
                    if(navigator.vibrate) navigator.vibrate(50); // İşlem bitti hissi
                }, 1000);
            }
        });

        // --- DÖNDÜRME MOTORU (Sadece Merkez Küp İçin) ---
        AFRAME.registerComponent('akilli-kontrol', {
            schema: { enabled: {default: false} },
            init: function () {
                this.isDown = false;
                this.lastX = 0; this.lastY = 0;
                this.rotX = 0; this.rotY = 0;
                
                this.onDown = (e) => { 
                    if(!this.data.enabled) return;
                    this.isDown = true; 
                    this.lastX = e.clientX || e.touches[0].clientX;
                    this.lastY = e.clientY || e.touches[0].clientY;
                };
                this.onUp = () => { this.isDown = false; };
                this.onMove = (e) => {
                    if(!this.isDown || !this.data.enabled) return;
                    let cx = e.clientX || e.touches[0].clientX;
                    let cy = e.clientY || e.touches[0].clientY;
                    
                    this.el.object3D.rotation.y += (cx - this.lastX) * 0.01;
                    this.el.object3D.rotation.x += (cy - this.lastY) * 0.01;
                    
                    this.lastX = cx; this.lastY = cy;
                };

                window.addEventListener('mousedown', this.onDown);
                window.addEventListener('touchstart', this.onDown, {passive:false});
                window.addEventListener('mouseup', this.onUp);
                window.addEventListener('touchend', this.onUp);
                window.addEventListener('mousemove', this.onMove);
                window.addEventListener('touchmove', this.onMove, {passive:false});
            }
        });

        function updateTitle(text) {
            let el = document.getElementById('main-title');
            el.style.opacity = 0;
            setTimeout(() => {
                el.innerText = text;
                el.style.opacity = 1;
            }, 500);
        }

    </script>

    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; touch-action: none; font-family: 'Segoe UI', sans-serif; }
        
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
        
        .header {
            position: absolute; top: 5%; width: 100%; text-align: center; pointer-events: none;
        }
        .header h1 {
            margin: 0; font-size: 2.5rem; color: #fff; 
            text-shadow: 0 0 20px rgba(255, 159, 67, 0.8);
            letter-spacing: 3px; transition: opacity 0.5s;
        }
        .header p { color: #aaa; margin-top: 5px; font-weight: 300; }

        .hint {
            position: absolute; bottom: 30px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.4); font-size: 0.9rem; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 0.8; } 100% { opacity: 0.4; } }

        /* MODAL */
        .modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
            width: 85%; max-width: 380px; 
            background: rgba(15, 15, 20, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 30px; 
            color: white; display: none; opacity: 0; pointer-events: auto; z-index: 99; 
            box-shadow: 0 0 100px rgba(0,0,0,1); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal.aktif { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .kapat-btn { background: linear-gradient(45deg, #ff4757, #ff6b81); color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; margin-top: 20px; cursor: pointer; }

    </style>
</head>

<body>

    <div id="ui-layer">
        <div class="header">
            <h1 id="main-title">YÜKLENİYOR...</h1>
            <p>Diğer küplere tıklayarak değiştirin</p>
        </div>
        <div class="hint">Uzun basarak seçim onayı alabilirsiniz</div>
    </div>

    <div id="modal-ar" class="modal"><h2>AR Teknolojisi</h2><p>Sınıf duvarlarını yıkın.</p><button class="kapat-btn" onclick="modalKapat()">Kapat</button></div>
    <a-scene background="color: #050505" cursor="rayOrigin: mouse" raycaster="objects: .tiklanabilir">
        
        <a-sky color="#050505"></a-sky>
        <a-entity position="0 0 0" particle-system="preset: dust; color: #ffffff; particleCount: 1000"></a-entity>

        <a-light type="ambient" intensity="0.6"></a-light>
        <a-light type="directional" position="-2 4 4" intensity="1.5" color="#ffffff"></a-light>
        <a-light type="point" position="0 2 0" intensity="2" distance="10" color="#ff9f43"></a-light>

        <a-camera id="ana-kamera" position="0 0 4" look-controls="enabled: false"></a-camera>

        <a-entity galaksi-yoneticisi position="0 0 0"></a-entity>

    </a-scene>

    <script>
        function modalAc(id) {
            let m = document.getElementById(id);
            if(m) {
                document.querySelectorAll('.modal').forEach(x => x.classList.remove('aktif'));
                m.classList.add('aktif');
            } else {
                alert("Bu özellik yakında eklenecek: " + id);
            }
        }
        function modalKapat() { document.querySelectorAll('.modal').forEach(x => x.classList.remove('aktif')); }
    </script>
</body>
</html>
